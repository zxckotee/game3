-- SQL скрипт для создания и заполнения таблиц ресурсов
-- Использует PostgreSQL синтаксис
\encoding UTF8
-- Удаление существующих таблиц
DROP TABLE IF EXISTS resource_effects CASCADE;
DROP TABLE IF EXISTS resources CASCADE;

-- Зависимость: resource_categories должна быть создана ранее (00_reference_tables.sql)
-- Зависимость: rarities должна быть создана ранее (00_reference_tables.sql)

-- Таблица ресурсов
CREATE TABLE resources (
    id VARCHAR(30) PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    type VARCHAR(30) REFERENCES resource_categories(id),
    rarity VARCHAR(20) REFERENCES rarities(id),
    description TEXT,
    value INTEGER,
    stackable BOOLEAN DEFAULT TRUE,
    max_stack INTEGER DEFAULT 99
);

-- Таблица эффектов ресурсов
CREATE TABLE resource_effects (
    id SERIAL PRIMARY KEY,
    resource_id VARCHAR(30) REFERENCES resources(id) ON DELETE CASCADE,
    effect_type VARCHAR(30) NOT NULL,
    description TEXT NOT NULL
);

-- Заполнение таблицы ресурсов (из resources.js)
INSERT INTO resources (id, name, type, rarity, description, value, stackable, max_stack) VALUES
-- Травы
('low_grade_herb', 'Трава низкого качества', 'herb', 'common', 'Обычная трава с небольшим количеством духовной энергии. Используется для базовых пилюль и медитации.', 10, TRUE, 99),
('medium_grade_herb', 'Трава среднего качества', 'herb', 'uncommon', 'Трава с заметным количеством духовной энергии. Используется для создания пилюль среднего качества.', 50, TRUE, 99),
('high_grade_herb', 'Трава высокого качества', 'herb', 'rare', 'Редкая трава с высокой концентрацией духовной энергии. Используется для создания качественных пилюль.', 200, TRUE, 99),
('rare_herb', 'Редкая трава', 'herb', 'epic', 'Очень редкая трава с исключительной духовной энергией. Используется для создания пилюль высшего качества.', 500, TRUE, 50),
('exotic_herb', 'Экзотическая трава', 'herb', 'legendary', 'Исключительно редкая трава с мощной духовной энергией. Используется для создания легендарных пилюль.', 2000, TRUE, 20),

-- Пилюли
('basic_pill', 'Базовая пилюля', 'pill', 'common', 'Простая пилюля, помогающая в начальной культивации. Ускоряет прогресс на ступени Закалка тела.', 30, TRUE, 99),
('qi_pill', 'Пилюля Ци', 'pill', 'uncommon', 'Пилюля, помогающая в очищении и циркуляции Ци. Полезна на ступени Очищение Ци.', 150, TRUE, 99),
('high_quality_pill', 'Высококачественная пилюля', 'pill', 'rare', 'Качественная пилюля, значительно ускоряющая культивацию. Особенно эффективна на ступени Золотое ядро.', 600, TRUE, 50),
('spirit_condensation_pill', 'Пилюля конденсации духа', 'pill', 'epic', 'Редкая пилюля, помогающая в формировании и укреплении души. Необходима для прогресса на ступени Формирование души.', 2000, TRUE, 20),
('immortal_essence_pill', 'Пилюля бессмертной эссенции', 'pill', 'legendary', 'Легендарная пилюля, содержащая эссенцию бессмертия. Крайне редкая и ценная.', 10000, TRUE, 5),

-- Минералы
('spirit_stone', 'Духовный камень', 'currency', 'uncommon', 'Камень, содержащий концентрированную духовную энергию. Основная валюта среди культиваторов.', 100, TRUE, 9999),
('spirit_mineral', 'Духовный минерал', 'mineral', 'rare', 'Редкий минерал с высокой концентрацией духовной энергии. Ценный ресурс для культиваторов среднего уровня.', 500, TRUE, 999),
('spirit_crystal', 'Духовный кристалл', 'mineral', 'epic', 'Кристаллизованная духовная энергия высокой чистоты. Необходим для продвинутой культивации.', 2000, TRUE, 99),
('heavenly_jade', 'Небесный нефрит', 'mineral', 'legendary', 'Легендарный минерал, содержащий эссенцию небесной энергии. Крайне редок и ценен.', 10000, TRUE, 10),

-- Эссенции
('water_essence', 'Водная эссенция', 'essence', 'uncommon', 'Концентрированная эссенция водной энергии. Используется для культивации техник водной стихии.', 200, TRUE, 99),
('fire_essence', 'Огненная эссенция', 'essence', 'uncommon', 'Концентрированная эссенция огненной энергии. Используется для культивации техник огненной стихии.', 200, TRUE, 99),
('earth_essence', 'Земляная эссенция', 'essence', 'uncommon', 'Концентрированная эссенция земляной энергии. Используется для культивации техник земляной стихии.', 200, TRUE, 99),
('wind_essence', 'Ветряная эссенция', 'essence', 'uncommon', 'Концентрированная эссенция энергии ветра. Используется для культивации техник воздушной стихии.', 200, TRUE, 99),
('spirit_essence', 'Духовная эссенция', 'essence', 'epic', 'Чистая духовная энергия в концентрированной форме. Редкий и ценный ресурс для продвинутой культивации.', 1000, TRUE, 50),

-- Души существ
('beast_soul', 'Душа зверя', 'soul', 'rare', 'Душа духовного зверя. Содержит уникальную энергию и может использоваться для усиления культивации.', 1500, TRUE, 10),
('demon_soul', 'Душа демона', 'soul', 'epic', 'Душа демонического существа. Содержит мощную, но опасную энергию.', 3000, TRUE, 5),
('ancient_soul', 'Древняя душа', 'soul', 'legendary', 'Душа древнего могущественного существа. Содержит знания и энергию давно минувших эпох.', 10000, FALSE, 1),

-- Артефакты
('spirit_gathering_formation', 'Формация сбора духовной энергии', 'artifact', 'uncommon', 'Артефакт, создающий формацию для сбора и концентрации духовной энергии в определенной области.', 800, TRUE, 5),
('protective_talisman', 'Защитный талисман', 'artifact', 'rare', 'Талисман с защитными заклинаниями. Создает барьер, защищающий от физических и духовных атак.', 1200, TRUE, 3),
('teleportation_compass', 'Компас телепортации', 'artifact', 'epic', 'Древний артефакт, позволяющий мгновенно перемещаться между отмеченными локациями.', 5000, FALSE, 1),

-- Материалы
('spirit_silk', 'Духовный шелк', 'material', 'uncommon', 'Шелк, сотканный с использованием духовной энергии. Используется для создания одежды и артефактов.', 300, TRUE, 99),
('spirit_iron', 'Духовное железо', 'material', 'uncommon', 'Железо, обогащенное духовной энергией. Используется для создания оружия и инструментов.', 300, TRUE, 99),
('celestial_wood', 'Небесная древесина', 'material', 'rare', 'Древесина от деревьев, растущих в местах с высокой концентрацией духовной энергии.', 800, TRUE, 50);

-- Заполнение таблицы эффектов ресурсов
INSERT INTO resource_effects (resource_id, effect_type, description) VALUES
-- Эффекты для трав
('low_grade_herb', 'meditation', 'Увеличивает эффективность медитации на 5% на 30 минут'),
('low_grade_herb', 'cultivation', 'Может использоваться для прорыва на ранних уровнях ступени Закалка тела'),
('medium_grade_herb', 'meditation', 'Увеличивает эффективность медитации на 10% на 1 час'),
('medium_grade_herb', 'cultivation', 'Может использоваться для прорыва на ступени Очищение Ци'),
('high_grade_herb', 'meditation', 'Увеличивает эффективность медитации на 15% на 2 часа'),
('high_grade_herb', 'cultivation', 'Может использоваться для прорыва на ступени Золотое ядро'),
('rare_herb', 'meditation', 'Увеличивает эффективность медитации на 20% на 4 часа'),
('rare_herb', 'cultivation', 'Необходима для прорыва на высоких уровнях ступени Золотое ядро'),
('exotic_herb', 'meditation', 'Увеличивает эффективность медитации на 30% на 8 часов'),
('exotic_herb', 'cultivation', 'Необходима для прорыва на ступени Формирование души'),

-- Эффекты для пилюль
('basic_pill', 'instant', 'Восстанавливает 20 единиц духовной энергии'),
('basic_pill', 'cultivation', 'Увеличивает опыт культивации на 50 единиц'),
('qi_pill', 'instant', 'Восстанавливает 50 единиц духовной энергии'),
('qi_pill', 'cultivation', 'Увеличивает опыт культивации на 150 единиц'),
('qi_pill', 'bottleneck', 'Увеличивает прогресс "бутылочного горлышка" на 5 единиц'),
('high_quality_pill', 'instant', 'Восстанавливает 100 единиц духовной энергии'),
('high_quality_pill', 'cultivation', 'Увеличивает опыт культивации на 400 единиц'),
('high_quality_pill', 'bottleneck', 'Увеличивает прогресс "бутылочного горлышка" на 15 единиц'),
('spirit_condensation_pill', 'instant', 'Восстанавливает 200 единиц духовной энергии'),
('spirit_condensation_pill', 'cultivation', 'Увеличивает опыт культивации на 1000 единиц'),
('spirit_condensation_pill', 'bottleneck', 'Увеличивает прогресс "бутылочного горлышка" на 30 единиц'),
('spirit_condensation_pill', 'tribulation', 'Увеличивает шанс успешного прохождения трибуляции на 10%'),
('immortal_essence_pill', 'instant', 'Полностью восстанавливает духовную энергию и увеличивает максимум на 10%'),
('immortal_essence_pill', 'cultivation', 'Увеличивает опыт культивации на 5000 единиц'),
('immortal_essence_pill', 'bottleneck', 'Увеличивает прогресс "бутылочного горлышка" на 100 единиц'),
('immortal_essence_pill', 'tribulation', 'Увеличивает шанс успешного прохождения трибуляции на 30%'),
('immortal_essence_pill', 'special', 'Имеет 5% шанс повысить уровень культивации на 1 без прорыва'),

-- Эффекты для минералов и эссенций
('spirit_stone', 'instant', 'Можно поглотить для восстановления 30 единиц духовной энергии'),
('spirit_stone', 'cultivation', 'Используется для прорыва на ступенях Закалка тела и Очищение Ци'),
('spirit_mineral', 'instant', 'Можно поглотить для восстановления 100 единиц духовной энергии'),
('spirit_mineral', 'cultivation', 'Используется для прорыва на ступенях Очищение Ци и Золотое ядро'),
('spirit_mineral', 'equipment', 'Используется для создания и улучшения духовного оружия и артефактов'),
('spirit_crystal', 'instant', 'Можно поглотить для восстановления 300 единиц духовной энергии'),
('spirit_crystal', 'cultivation', 'Используется для прорыва на ступени Золотое ядро и Формирование души'),
('spirit_crystal', 'equipment', 'Ключевой компонент для создания мощных артефактов'),
('heavenly_jade', 'instant', 'Можно поглотить для восстановления 1000 единиц духовной энергии'),
('heavenly_jade', 'cultivation', 'Значительно увеличивает шансы успешного прорыва на любой ступени'),
('heavenly_jade', 'equipment', 'Основной материал для создания легендарных артефактов'),
('heavenly_jade', 'special', 'Может использоваться для создания формации, увеличивающей скорость культивации на 50% на 24 часа'),

-- Эффекты для эссенций
('water_essence', 'techniques', 'Увеличивает эффективность водных техник на 20%'),
('water_essence', 'cultivation', 'Помогает в культивации водных техник'),
('water_essence', 'crafting', 'Используется для создания водных артефактов и пилюль'),
('fire_essence', 'techniques', 'Увеличивает эффективность огненных техник на 20%'),
('fire_essence', 'cultivation', 'Помогает в культивации огненных техник'),
('fire_essence', 'crafting', 'Используется для создания огненных артефактов и пилюль'),
('earth_essence', 'techniques', 'Увеличивает эффективность земляных техник на 20%'),
('earth_essence', 'cultivation', 'Помогает в культивации земляных техник'),
('earth_essence', 'crafting', 'Используется для создания земляных артефактов и пилюль'),
('wind_essence', 'techniques', 'Увеличивает эффективность воздушных техник на 20%'),
('wind_essence', 'cultivation', 'Помогает в культивации воздушных техник'),
('wind_essence', 'crafting', 'Используется для создания воздушных артефактов и пилюль'),
('spirit_essence', 'techniques', 'Увеличивает эффективность всех техник на 15%'),
('spirit_essence', 'cultivation', 'Значительно ускоряет культивацию'),
('spirit_essence', 'crafting', 'Ключевой компонент для создания мощных артефактов и пилюль'),
('spirit_essence', 'special', 'Может использоваться для временного увеличения духовной силы на 30%');
