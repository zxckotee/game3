# Структура системы репутации в игре "Путь к Бессмертию"

## 1. Обзор системы

Система репутации представляет собой комбинированный механизм, отслеживающий отношения игрока с различными географическими и социальными сущностями игрового мира. Система влияет на доступные возможности, отношение NPC, цены в магазинах и другие аспекты геймплея.

## Система погоды и времени суток
  Динамическая смена времени суток:

  7 периодов дня (рассвет, утро, полдень, день, вечер, ночь, глубокая ночь)
  Каждый период имеет свои визуальные эффекты (CSS-фильтры) и игровые бонусы
  Плавная смена дня и ночи с соответствующими модификаторами геймплея
  Система погоды с 6 типами погодных условий:

  Ясно, облачно, дождь, гроза, туман, снег
  Каждый тип погоды влияет на геймплей (скорость передвижения, восприятие, культивацию)
  Вероятность появления погоды зависит от сезона и локации
  Сезонный цикл:

  4 сезона (весна, лето, осень, зима) с уникальными модификаторами
  Особые сезонные события с редкими ресурсами и эффектами
  Каждый сезон влияет на вероятность определенных погодных условий
  Игровые эффекты:

  Эффекты модификации культивации разных стихий в зависимости от времени суток и погоды
  Бонусы к сбору ресурсов в зависимости от сезона
  Модификаторы боевых показателей и передвижения
  Возможность получения редких ресурсов во время особых событий
  Система полностью модульная и может быть легко интегрирована в существующий игровой цикл. 

  **Для использования:**
    Инициализация сервиса
    const weatherService = new WeatherService();

    // Получение начальных погодных условий
    const weatherState = weatherService.initWeather(currentLocation);

    // Обновление погоды (например, каждый игровой тик)
    const updatedWeather = weatherService.updateTime(weatherState, currentLocation, timeIncreaseInMinutes);

    // Применение эффектов к игроку
    const effects = weatherService.applyWeatherEffects(player, updatedWeather);

    // Получение визуальных эффектов для отображения
    const visualEffects = weatherService.getVisualEffects(updatedWeather);


## 2. Структура данных

### 2.1. Основные модели

**Reputation** - основная модель репутации:
- Отслеживает репутацию игрока относительно городов, фракций и сфер влияния
- Хранит текущее числовое значение и уровень репутации
- Содержит историю изменений репутации

**ReputationFeature** - модель доступных возможностей:
- Определяет особые возможности, доступные при определённом уровне репутации
- Связывает возможности с конкретными городами/фракциями и сферами влияния
- Содержит данные о типе и параметрах возможности

**ReputationRelation** - модель взаимосвязей репутаций:
- Описывает влияние изменения одного типа репутации на другие
- Определяет силу и направление взаимовлияния
- Создаёт сложную сеть социальных отношений

### 2.2. Вспомогательные структуры

**ReputationLevel** - перечисление уровней репутации:
- Враждебный (-100 до -75)
- Неприязненный (-74 до -50)
- Подозрительный (-49 до -25)
- Нейтральный (-24 до 24)
- Дружелюбный (25 до 49)
- Уважаемый (50 до 74)
- Почитаемый (75 до 99)
- Легендарный (100)

**EntityType** - типы сущностей:
- city: Города и поселения
- faction: Фракции и организации
- global: Глобальная репутация

**Sphere** - сферы влияния:
- combat: Боевая слава
- trade: Торговое влияние
- spiritual: Духовный авторитет
- alchemy: Алхимическая репутация
- political: Политический вес
- general: Общая репутация

## 3. Интеграция с существующими системами

### 3.1. GameContext

```
src/context/
  ├── actions/
  │   ├── actionTypes.js  # Добавлены типы действий для репутации
  │   └── reputationActions.js  # Действия для изменения репутации
  ├── reducers/
  │   ├── reputationReducer.js  # Обработка изменений репутации
  │   └── rootReducer.js  # Обновлен для включения reputationReducer
  └── state/
      └── initialState.js  # Добавлено начальное состояние репутации
```

### 3.2. Модели и миграции

```
src/models/
  ├── reputation.js  # Основная модель репутации
  ├── reputation-feature.js  # Модель возможностей репутации
  └── reputation-relation.js  # Модель взаимосвязей репутаций

src/migrations/
  └── YYYY-MM-DD-create-reputation-tables.js  # Миграция для создания таблиц репутации
```

### 3.3. Сервисы

```
src/services/
  └── reputation-service.js  # Сервис для работы с репутацией
```

### 3.4. Компоненты интерфейса

```
src/components/
  ├── tabs/
  │   └── ReputationTab.js  # Новая вкладка для просмотра и управления репутацией
  └── ui/
      ├── ReputationBadge.js  # Компонент для отображения уровня репутации
      └── ReputationHistoryList.js  # Список событий, повлиявших на репутацию
```

## 4. Механики и функциональность

### 4.1. Изменение репутации

Репутация изменяется в результате:
- Выполнения квестов для города/фракции
- Защиты города от монстров или враждебных культиваторов
- Продажи редких товаров местным торговцам
- Создания лекарств во время эпидемий
- Пожертвования ресурсов или духовных камней
- Преступлений (кража, нападение на NPC)
- Участия и побед в городских соревнованиях
- Решения проблем отдельных жителей
- Прорыва на новый уровень культивации в городе

### 4.2. Система взаимосвязей

При изменении репутации:
1. Вычисляется прямой эффект действия на целевую репутацию
2. Определяются все связанные репутации через таблицу ReputationRelation
3. Для каждой связанной репутации вычисляется косвенный эффект
4. Обновляются все затронутые значения репутации
5. Проверяется изменение уровней репутации
6. Определяются новые доступные возможности
7. Игрок получает уведомления об изменениях

### 4.3. Уникальные возможности в городах

Каждый город имеет набор уникальных возможностей, доступных при определённых уровнях репутации:

**Небесный Город (столица):**
- Доступ к тренировкам с элитными инструкторами
- Возможность участвовать в императорской охоте
- Звание "Защитник Империи" с уникальным набором боевой брони
- Титул и земли, возможность основать собственный клан

**Туманная Долина (центр алхимиков):**
- Доступ к редким рецептам пилюль
- Возможность арендовать усовершенствованную алхимическую печь
- Обучение у Бессмертного Алхимика, открытие уникальных рецептов
- Доступ к медитативным пещерам с повышенной духовной энергией

**Огненная Гора (кузнецы):**
- Скидка на все оружие и броню
- Возможность заказа именного оружия с уникальными свойствами
- Доступ к технологии духовной ковки
- Обучение технике "Огненный кулак"

**Нефритовая Гавань (порт):**
- Доступ к экзотическим товарам из-за моря
- Возможность инвестировать в торговые экспедиции
- Собственный торговый корабль и эксклюзивные торговые маршруты
- Связи с контрабандистами, доступ к черному рынку

### 4.4. Интерфейс пользователя

Система репутации представлена в игре через:
- Вкладку "Репутация" в профиле игрока
- Индикаторы репутации при входе в город или взаимодействии с NPC
- Систему уведомлений об изменении репутации
- Визуальные эффекты и титулы для отображения статуса игрока
- Журнал репутации с историей действий, повлиявших на репутацию

## 5. Система случайных событий

### 5.1. Архитектура системы

Система случайных событий использует модульную плагинную архитектуру:

```
src/events/
  ├── core/
  │   ├── AbstractEvent.js      # Базовый класс для всех событий
  │   ├── EventRegistry.js      # Реестр для регистрации событий
  │   └── EventManager.js       # Управление активацией событий
  ├── plugins/
  │   ├── index.js              # Центральный экспорт всех плагинов
  │   ├── nature/               # Плагин природных явлений
  │   │   ├── SpiritStormEvent.js
  │   │   ├── SpiritualRainEvent.js
  │   │   └── index.js
  │   ├── social/               # Плагин социальных событий
  │   │   ├── CultivatorFairEvent.js
  │   │   └── index.js
  │   ├── combat/               # Плагин боевых столкновений
  │   │   ├── BanditAttackEvent.js
  │   │   └── index.js
  │   └── cycle/                # Плагин цикличных событий 
  │       ├── LunarPhaseEvent.js
  │       └── index.js
  └── services/
      └── event-service.js      # Сервис для работы с событиями
```

### 5.2. Категории событий

Система включает четыре основные категории событий:

#### 5.2.1. Природные явления
- **Духовный шторм (SpiritStormEvent)** - увеличивает концентрацию энергии, повышает скорость культивации
- **Дождь духовного нектара (SpiritualRainEvent)** - ускоряет рост растений, повышает качество трав
- *Планируемые события:* звездопады с духовными камнями, миграции редких духовных существ, временные искажения реальности

#### 5.2.2. Социальные события
- **Ярмарка культиваторов (CultivatorFairEvent)** - возможность торговли, сбора информации, улучшения отношений с сектами
- *Планируемые события:* собрания сект с обменом техниками, турниры между талантливыми учениками, аукционы редкостей, дипломатические встречи

#### 5.2.3. Боевые столкновения
- **Нападение разбойников (BanditAttackEvent)** - возможность вступить в бой, запугать, откупиться или сбежать
- *Планируемые события:* вторжения демонических культиваторов, появление древних существ, прорывы из других измерений, конфликты между сектами

#### 5.2.4. Циклические события
- **Лунные фазы (LunarPhaseEvent)** - влияют на духовную энергию, водные техники и другие аспекты игры
- *Планируемые события:* смена времен года, столетнее цветение духовных деревьев, экологический баланс, система слухов

### 5.3. Структура событий

Каждое событие имеет следующие ключевые компоненты:

#### 5.3.1. Условия появления
- **Минимальный уровень игрока** - базовое требование для появления события
- **Модификаторы сезона** - вероятность появления в зависимости от текущего сезона
- **Модификаторы времени суток** - вероятность появления в разное время дня
- **Модификаторы погоды** - зависимость от текущих погодных условий
- **Модификаторы локации** - вероятность появления в разных типах местности

#### 5.3.2. Эффекты
- **Глобальные эффекты** - влияние на общие параметры игрового мира
- **Эффекты для игрока** - временные модификаторы характеристик игрока
- **Визуальные эффекты** - изменения в отображении игрового мира

#### 5.3.3. Выборы и результаты
- **Варианты действий** - разные способы взаимодействия с событием
- **Требования к выбору** - некоторые действия требуют определенных навыков или характеристик
- **Результаты действий** - различные последствия в зависимости от выбора игрока
- **Система наград** - предметы, опыт, репутация и другие награды

#### 5.3.4. Управление жизненным циклом
- **Активация события** - определение времени и условий появления
- **Применение эффектов** - влияние на игровой мир в течение события
- **Завершение события** - очистка эффектов, подведение итогов

### 5.4. Закономерности и циклы

Система включает предсказуемые паттерны для опытных игроков:

#### 5.4.1. Лунный цикл
- **8 фаз луны** - от новолуния до полнолуния и обратно
- **28-дневный цикл** - полный оборот всех фаз
- **Предсказуемые эффекты** - каждая фаза имеет уникальное влияние на игровой мир:
  - Полнолуние: усиливает духовную энергию и трансформационные процессы
  - Новолуние: усиливает скрытность и редкие теневые способности
  - Другие фазы: промежуточные эффекты с уникальными бонусами

#### 5.4.2. Экологическая система
- **Баланс ресурсов** - чрезмерный сбор временно снижает появление
- **Ограничение редких событий** - мощные события имеют длительный период восстановления
- **Учет действий игрока** - система адаптируется к стилю игры и предпочтениям

#### 5.4.3. Система слухов
- **Предвестники событий** - возможность получить информацию о предстоящих событиях
- **Неопределенность информации** - слухи могут быть неточными или ложными
- **Навык прогнозирования** - развитие специализированных навыков для более точных предсказаний

### 5.5. Интеграция с другими системами

Система случайных событий взаимодействует с другими игровыми механиками:

#### 5.5.1. Система культивации
- События могут ускорять или замедлять прогресс культивации
- Некоторые события предоставляют редкие возможности для прорыва

#### 5.5.2. Система секты
- События могут влиять на репутацию и отношения между сектами
- Возможность встретить редких мастеров и получить уникальные техники

#### 5.5.3. Система крафта и алхимии
- События могут предоставлять редкие ингредиенты
- Особые события позволяют создавать уникальные предметы

#### 5.5.4. Система погоды и времени
- События тесно связаны с погодными условиями и временем суток
- Создание сложной взаимосвязанной экосистемы игрового мира
