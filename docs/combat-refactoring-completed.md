# –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ Combat Service - –≠—Ç–∞–ø 1

## üéØ –í–´–ü–û–õ–ù–ï–ù–ù–´–ï –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø

### ‚úÖ 1. –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è —Ñ–æ—Ä–º—É–ª HP/Energy –≤ CharacterStatsService

**–ü—Ä–æ–±–ª–µ–º–∞**: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–æ—Ä–º—É–ª —Ä–∞—Å—á–µ—Ç–∞ HP/Energy –≤ `startCombat()` –∏ `_recalculateCombatStats()`

**–†–µ—à–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–Ω—ã —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ CharacterStatsService:

```javascript
// src/services/character-stats-service.js

/**
 * –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
 */
static calculateMaxHp(level, healthStat) {
  return 100 + (level * 2) + (healthStat * 2);
}

/**
 * –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —ç–Ω–µ—Ä–≥–∏—é –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
 */
static calculateMaxEnergy(level, energyStat) {
  return 50 + (level * 1) + (energyStat * 1);
}

/**
 * –ü–æ–ª—É—á–∞–µ—Ç –ø–æ–ª–Ω–æ–µ –±–æ–µ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –±–æ—è—Ö
 */
static async getCombatCharacterState(userId, transaction) {
  const combinedState = await this.getCombinedCharacterState(userId, transaction);
  
  const level = combinedState.primary.level || 1;
  const healthStat = combinedState.primary.health || 10;
  const energyStat = combinedState.primary.energy || 50;
  
  return {
    ...combinedState,
    combat: {
      maxHp: this.calculateMaxHp(level, healthStat),
      maxEnergy: this.calculateMaxEnergy(level, energyStat),
      currentHp: this.calculateMaxHp(level, healthStat),
      currentEnergy: this.calculateMaxEnergy(level, energyStat)
    }
  };
}
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ Combat Service**:

1. **startCombat()**: –ó–∞–º–µ–Ω–µ–Ω –≤—ã–∑–æ–≤ `getCombinedCharacterState()` –Ω–∞ `getCombatCharacterState()`
2. **_recalculateCombatStats()**: –ó–∞–º–µ–Ω–µ–Ω—ã –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—É–ª—ã –Ω–∞ –≤—ã–∑–æ–≤—ã —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

### ‚úÖ 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è physicalAttack –≤ —Ä–∞—Å—á–µ—Ç —É—Ä–æ–Ω–∞

**–ü—Ä–æ–±–ª–µ–º–∞**: physicalAttack –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –≤ PvE –±–æ—è—Ö, –¥–µ–ª–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É –±–µ—Å–ø–æ–ª–µ–∑–Ω–æ–π

**–†–µ—à–µ–Ω–∏–µ**: –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_calculateDamage()`:

```javascript
// src/services/combat-service.js

static _calculateDamage(attackerState, defenderState, techniqueDamage = null, damageType = 'physical', actionType = 'attack') {
  // 1. –û–ø—Ä–µ–¥–µ–ª—è–µ–º –±–∞–∑–æ–≤—ã–π —É—Ä–æ–Ω –∞—Ç–∞–∫—É—é—â–µ–≥–æ
  let baseDamage = 0;
  
  if (actionType === 'technique' && techniqueDamage) {
    // –¢–µ—Ö–Ω–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä—è–º–æ–π —É—Ä–æ–Ω
    baseDamage = techniqueDamage;
  } else {
    // –î–ª—è –æ–±—ã—á–Ω—ã—Ö –∞—Ç–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ–º physicalAttack –∏–ª–∏ spiritualAttack
    if (damageType === 'physical' && attackerState.secondaryStats?.physicalAttack) {
      baseDamage = attackerState.secondaryStats.physicalAttack;
    } else if (damageType === 'spiritual' && attackerState.secondaryStats?.spiritualAttack) {
      baseDamage = attackerState.secondaryStats.spiritualAttack;
    } else {
      // Fallback –∫ —Å—Ç–∞—Ä–æ–π —Ñ–æ—Ä–º—É–ª–µ –¥–ª—è –≤—Ä–∞–≥–æ–≤
      const attackerLevel = attackerState.baseStats?.level || attackerState.enemyLevel || 1;
      const defenderMaxHp = defenderState.maxHp || 100;
      const damagePercent = 10 + attackerLevel;
      baseDamage = Math.floor((defenderMaxHp * damagePercent) / 100);
    }
  }

  // 2. –ü—Ä–∏–º–µ–Ω—è–µ–º –∑–∞—â–∏—Ç—É
  let defense = 0;
  if (damageType === 'physical' && defenderState.secondaryStats?.physicalDefense) {
    defense = defenderState.secondaryStats.physicalDefense;
  } else if (damageType === 'spiritual' && defenderState.secondaryStats?.spiritualDefense) {
    defense = defenderState.secondaryStats.spiritualDefense;
  }
  
  // 3. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —É—Ä–æ–Ω –ø–æ—Å–ª–µ –∑–∞—â–∏—Ç—ã
  let damage = Math.max(1, baseDamage - defense);
  
  // 4. –û—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É–¥–∞—Ä—ã, —É–∫–ª–æ–Ω–µ–Ω–∏–µ, —ç—Ñ—Ñ–µ–∫—Ç—ã)
  // ...
  
  return {
    damage,
    baseDamage: baseDamage,
    defense: defense,
    isCrit,
    isDodge: false,
    critChance: critChance,
    dodgeChance: dodgeChance
  };
}
```

### ‚úÖ 3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—á–µ—Ç–∞ –∑–∞—â–∏—Ç—ã –≤ —Ä–∞—Å—á–µ—Ç —É—Ä–æ–Ω–∞

**–ü—Ä–æ–±–ª–µ–º–∞**: physicalDefense –∏ spiritualDefense –Ω–µ —É—á–∏—Ç—ã–≤–∞–ª–∏—Å—å –≤ —Ä–∞—Å—á–µ—Ç–µ —É—Ä–æ–Ω–∞

**–†–µ—à–µ–Ω–∏–µ**: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –∑–∞—â–∏—Ç–∞ –≤ —Ñ–æ—Ä–º—É–ª—É —É—Ä–æ–Ω–∞:
- –§–∏–∑–∏—á–µ—Å–∫–∞—è –∑–∞—â–∏—Ç–∞ —É–º–µ–Ω—å—à–∞–µ—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π —É—Ä–æ–Ω
- –î—É—Ö–æ–≤–Ω–∞—è –∑–∞—â–∏—Ç–∞ —É–º–µ–Ω—å—à–∞–µ—Ç –¥—É—Ö–æ–≤–Ω—ã–π —É—Ä–æ–Ω
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–Ω –≤—Å–µ–≥–¥–∞ = 1

### ‚úÖ 4. –£–ª—É—á—à–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–æ—è

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ playerState**:
```javascript
const playerState = {
  currentHp: calculatedMaxHp,
  maxHp: calculatedMaxHp,
  currentEnergy: calculatedMaxEnergy,
  maxEnergy: calculatedMaxEnergy,
  baseStats: combatState.primary,           // –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∞—Ç—ã
  modifiedStats: combatState.primary,       // –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ç—ã (–≤–∫–ª—é—á–∞—è —ç—Ñ—Ñ–µ–∫—Ç—ã —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏)
  secondaryStats: combatState.secondary,    // –í—Ç–æ—Ä–∏—á–Ω—ã–µ —Å—Ç–∞—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
  effects: [],
  techniques: learnedTechniques || []
};
```

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

–°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç `test-combat-refactoring.js` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π:

### –¢–µ—Å—Ç–∏—Ä—É–µ–º—ã–µ –∞—Å–ø–µ–∫—Ç—ã:
1. **–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—É–ª—ã HP/Energy** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Ä–∞—Å—á–µ—Ç–æ–≤
2. **–†–∞—Å—á–µ—Ç —É—Ä–æ–Ω–∞ —Å physicalAttack** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤—Ç–æ—Ä–∏—á–Ω—ã—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
3. **–£—á–µ—Ç –∑–∞—â–∏—Ç—ã** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —É–º–µ–Ω—å—à–µ–Ω–∏—è —É—Ä–æ–Ω–∞ –æ—Ç –∑–∞—â–∏—Ç—ã
4. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –±–æ–Ω—É—Å–æ–≤

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:
```bash
node test-combat-refactoring.js
```

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –†–ï–§–ê–ö–¢–û–†–ò–ù–ì–ê

### ‚úÖ –î–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–µ —Ü–µ–ª–∏:

1. **–£—Å—Ç—Ä–∞–Ω–µ–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞**
   - –§–æ—Ä–º—É–ª—ã HP/Energy —Ç–µ–ø–µ—Ä—å –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
   - –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö —Ä–∞—Å—á–µ—Ç–æ–≤

2. **physicalAttack —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ PvE –±–æ—è—Ö**
   - –≠—Ñ—Ñ–µ–∫—Ç—ã —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏ –Ω–∞ physicalAttack –≤–ª–∏—è—é—Ç –Ω–∞ —É—Ä–æ–Ω
   - –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ —Å—Ç–∞–ª–∞ –ø–æ–ª–µ–∑–Ω–æ–π

3. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –∑–∞—â–∏—Ç–∞**
   - physicalDefense —É–º–µ–Ω—å—à–∞–µ—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π —É—Ä–æ–Ω
   - spiritualDefense —É–º–µ–Ω—å—à–∞–µ—Ç –¥—É—Ö–æ–≤–Ω—ã–π —É—Ä–æ–Ω

4. **–£–ª—É—á—à–µ–Ω–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**
   - –ï–¥–∏–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞—Å—á–µ—Ç–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
   - –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å–∏—Å—Ç–µ–º–æ–π —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏

### üìà –í–ª–∏—è–Ω–∏–µ –Ω–∞ –∏–≥—Ä–æ–≤–æ–π –ø—Ä–æ—Ü–µ—Å—Å:

1. **–≠—Ñ—Ñ–µ–∫—Ç—ã —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞—é—Ç –≤ PvE**
   - –û—Ä—É–∂–∏–µ —Å +physicalAttack —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —É—Ä–æ–Ω
   - –ë—Ä–æ–Ω—è —Å +physicalDefense —É–º–µ–Ω—å—à–∞–µ—Ç –ø–æ–ª—É—á–∞–µ–º—ã–π —É—Ä–æ–Ω

2. **–ë–æ–ª–µ–µ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –±–æ–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞**
   - –ó–∞—â–∏—Ç–∞ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ
   - –í—Ç–æ—Ä–∏—á–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –≤–ª–∏—è—é—Ç –Ω–∞ –±–æ–π

3. **–ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–µ —Ä–∞—Å—á–µ—Ç—ã**
   - –û–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Ñ–æ—Ä–º—É–ª—ã –≤–µ–∑–¥–µ
   - –õ–µ–≥—á–µ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞—Ç—å –∏–≥—Ä—É

## üîÑ –û–ë–†–ê–¢–ù–ê–Ø –°–û–í–ú–ï–°–¢–ò–ú–û–°–¢–¨

### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:
- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –±–æ–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- –í—Ä–∞–≥–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç fallback –∫ —Å—Ç–∞—Ä–æ–π —Ñ–æ—Ä–º—É–ª–µ —É—Ä–æ–Ω–∞
- –í—Å–µ —Ç–µ—Ö–Ω–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ

### –£–ª—É—á—à–µ–Ω–∏—è –¥–ª—è –∏–≥—Ä–æ–∫–æ–≤:
- –≠—Ñ—Ñ–µ–∫—Ç—ã —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏ —Ç–µ–ø–µ—Ä—å –≤–ª–∏—è—é—Ç –Ω–∞ —É—Ä–æ–Ω –≤ PvE
- –ó–∞—â–∏—Ç–∞ —Å—Ç–∞–ª–∞ –ø–æ–ª–µ–∑–Ω–æ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–æ–π
- –ë–æ–ª–µ–µ —Ç–æ—á–Ω—ã–µ —Ä–∞—Å—á–µ—Ç—ã —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –≠–¢–ê–ü–´

### –≠—Ç–∞–ø 2: –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
1. –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –º–µ–∂–¥—É Combat –∏ PvP Service
2. –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—â–µ–π —Å–∏—Å—Ç–µ–º—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
3. –£–ø—Ä–æ—â–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤

### –≠—Ç–∞–ø 3: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
1. –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—â–∏—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –¥–ª—è –±–æ–µ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
2. –£–ø—Ä–æ—â–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–æ—è
3. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å–ª–æ–∂–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

## üìã –ß–ï–ö–õ–ò–°–¢ –í–´–ü–û–õ–ù–ï–ù–ù–´–• –ó–ê–î–ê–ß

- [x] –°–æ–∑–¥–∞—Ç—å `calculateMaxHp()` –≤ CharacterStatsService
- [x] –°–æ–∑–¥–∞—Ç—å `calculateMaxEnergy()` –≤ CharacterStatsService  
- [x] –°–æ–∑–¥–∞—Ç—å `getCombatCharacterState()` –≤ CharacterStatsService
- [x] –û–±–Ω–æ–≤–∏—Ç—å `startCombat()` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- [x] –û–±–Ω–æ–≤–∏—Ç—å `_recalculateCombatStats()` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- [x] –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å `_calculateDamage()` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è physicalAttack
- [x] –î–æ–±–∞–≤–∏—Ç—å —É—á–µ—Ç –∑–∞—â–∏—Ç—ã –≤ —Ä–∞—Å—á–µ—Ç —É—Ä–æ–Ω–∞
- [x] –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
- [x] –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É playerState

## ‚ö†Ô∏è –í–ê–ñ–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:
1. **–§–æ—Ä–º—É–ª—ã HP/Energy** —Ç–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ –≤ CharacterStatsService
2. **physicalAttack/spiritualAttack** –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —Ä–∞—Å—á–µ—Ç–µ —É—Ä–æ–Ω–∞
3. **–ó–∞—â–∏—Ç–∞** –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ —É—Ä–æ–Ω
4. **Fallback –ª–æ–≥–∏–∫–∞** —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –¥–ª—è –≤—Ä–∞–≥–æ–≤

### –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —ç—Ñ—Ñ–µ–∫—Ç—ã —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏ –≤–ª–∏—è—é—Ç –Ω–∞ —É—Ä–æ–Ω –≤ PvE
2. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –∑–∞—â–∏—Ç–∞ —É–º–µ–Ω—å—à–∞–µ—Ç –ø–æ–ª—É—á–∞–µ–º—ã–π —É—Ä–æ–Ω
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ HP/Energy —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –æ–¥–∏–Ω–∞–∫–æ–≤–æ –≤–µ–∑–¥–µ

### –î–ª—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏:
1. –í–æ–∑–º–æ–∂–Ω–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ—Å–º–æ—Ç—Ä –∑–Ω–∞—á–µ–Ω–∏–π physicalAttack
2. –ó–∞—â–∏—Ç–∞ –º–æ–∂–µ—Ç —Å–¥–µ–ª–∞—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –≤—Ä–∞–≥–æ–≤ —Å–ª–∏—à–∫–æ–º —Å–ª–∞–±—ã–º–∏
3. –≠—Ñ—Ñ–µ–∫—Ç—ã —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏ —Ç–µ–ø–µ—Ä—å –±–æ–ª–µ–µ –∑–Ω–∞—á–∏–º—ã

## üéâ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

–≠—Ç–∞–ø 1 —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã:
- ‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–æ—Ä–º—É–ª
- ‚úÖ physicalAttack —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ PvE –±–æ—è—Ö  
- ‚úÖ –ó–∞—â–∏—Ç–∞ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ —Ä–∞—Å—á–µ—Ç–µ —É—Ä–æ–Ω–∞
- ‚úÖ –≠—Ñ—Ñ–µ–∫—Ç—ã —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏ –≤–ª–∏—è—é—Ç –Ω–∞ –±–æ–π

–°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–ª–∞ –±–æ–ª–µ–µ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–π, –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–π –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π. –ò–≥—Ä–æ–∫–∏ —Ç–µ–ø–µ—Ä—å –ø–æ–ª—É—á–∞—é—Ç –ø–æ–ª–Ω—É—é –ø–æ–ª—å–∑—É –æ—Ç —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏ –≤ PvE –±–æ—è—Ö.